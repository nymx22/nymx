<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>basement</title>
    <link rel="icon" type="image/png" href="../assets/icons/fav_icon.png">
    <link rel="stylesheet" href="https://use.typekit.net/pew7esm.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+25&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style/main.css" />
    <link rel="stylesheet" href="../style/basement/layout.css" />
    <link rel="stylesheet" href="../style/basement/wall.css" />
    <link rel="stylesheet" href="../style/basement/floor.css" />
    <link rel="stylesheet" href="../style/basement/pebbles.css" />
    <link rel="stylesheet" href="../style/basement/self.css" />
    <link rel="stylesheet" href="../style/basement/self0hint.css" />
    <link rel="stylesheet" href="../style/basement/glitch.css" />
    <link rel="stylesheet" href="../style/basement/vignette.css" />
    <link rel="stylesheet" href="../style/basement/cursor.css" />
    <link rel="stylesheet" href="../style/basement/gui.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.7/build/dat.gui.min.js"></script>
    <style>
      /* Loading screen */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: #ffffff;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.8s ease-out;
      }
      
      .loading-screen.hidden {
        opacity: 0;
        pointer-events: none;
      }
      
      /* Hide content until loaded (but not cursor) */
      body.loading .wall-section,
      body.loading .floor-section,
      body.loading .self-container,
      body.loading #basement-glitch-canvas,
      body.loading .vignette-overlay,
      body.loading .basement-content {
        opacity: 0;
      }
      
      /* Smooth fade-in for content */
      .wall-section,
      .floor-section,
      .self-container,
      #basement-glitch-canvas,
      .vignette-overlay,
      .basement-content {
        transition: opacity 0.8s ease-in;
      }
    </style>
  </head>
  <body class="loading">
    <!-- Loading screen -->
    <div class="loading-screen" id="loadingScreen"></div>
    
    <div class="custom-cursor">
      <img src="../assets/gif/cursor.gif" alt="cursor">
    </div>
    
    <!-- Background sections -->
    <div class="wall-section"></div>
    <div class="floor-section"></div>
    
      <!-- Self 0 with shader effects -->
      <div class="self-container">
        <div id="self-shader-container"></div>
      </div>
    
    <!-- Snow glitch overlay -->
    <div id="basement-glitch-canvas"></div>
    
    <!-- White vignette overlay -->
    <div class="vignette-overlay"></div>
    
    <div class="basement-content">
      <a href="../index.html" class="back-link">return</a>
    </div>
    
    <script type="module">
      import { initPebbleFloor } from '../js/lib/desktop/pebbleFloor.js';
      import { pureSnow } from '../js/effects/glitch/pureSnow.js';
      import { initSelf0Shader } from '../js/lib/basement/self0Shader.js';
      
      // Wait for everything to load
      window.addEventListener('load', async () => {
        const loadingScreen = document.getElementById('loadingScreen');
        
        // Initialize custom cursor
        const customCursor = document.querySelector('.custom-cursor');
        document.addEventListener('mousemove', (e) => {
          customCursor.style.setProperty('--mouse-x', `${e.clientX - 32}px`);
          customCursor.style.setProperty('--mouse-y', `${e.clientY - 32}px`);
        }, { passive: true });
        
        // Initialize pebble floor
        await initPebbleFloor();
        
        // Initialize self0 shader with GUI
        initSelf0Shader();
        
        // Initialize p5 sketch for snow glitch (optimized)
        const sketch = (p) => {
          p.setup = () => {
            const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
            canvas.parent('basement-glitch-canvas');
            p.pixelDensity(1);
            p.frameRate(30); // Limit frame rate for performance
          };
          
          p.draw = () => {
            pureSnow(p);
          };
          
          p.windowResized = () => {
            p.resizeCanvas(p.windowWidth, p.windowHeight);
          };
        };
        
        new p5(sketch);
        
        // Wait for initial render, then smoothly transition
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            // Remove loading class to fade in content
            document.body.classList.remove('loading');
            
            // Wait for content to start fading in, then hide loading screen
            setTimeout(() => {
              loadingScreen.classList.add('hidden');
            }, 100);
          });
        });
      });
    </script>
    
  </body>
</html>

